(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){e.exports=a(22)},19:function(e,t,a){},21:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(10),s=a.n(i),c=(a(19),a(11)),o=a(7),u=a.n(o),l=a(12),m=a(8),p=a(1),h=a(2),d=a(4),y=a(3),v=a(6),f=a(5),C={apiBaseUrl:"https://api.openaq.org/v1",allowedParameters:["pm25","pm10","so2","no2","o3","co","bc"]},E=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._allowedParameters=C.allowedParameters,a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"getCities",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{limit:100};return this._query(this._citiesUrl,e)}},{key:"getMeasurements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.parameter&&this._validateParametersForMeasurements(e.parameter),this._query(this._measurementsUrl,e)}},{key:"getNearestCityByCoordinates",value:function(e,t){return this._query(this._locationUrl,{coordinates:"".concat(e,",").concat(t),limit:1,nearest:""})}},{key:"_validateParameterForMeasurements",value:function(e){if(!this._allowedParameters.includes(e))throw new Error("You have included a filter by parameter which is not allowed (".concat(e,")"));return!0}},{key:"_validateParametersForMeasurements",value:function(e){var t=this;return"object"===typeof e?e.forEach(function(e){return t._validateParameterForMeasurements(e)}):this._validateParameterForMeasurements(e),!0}},{key:"_citiesUrl",get:function(){return"".concat(this.apiBaseUrl,"/cities")}},{key:"_locationUrl",get:function(){return"".concat(this.apiBaseUrl,"/locations")}},{key:"_measurementsUrl",get:function(){return"".concat(this.apiBaseUrl,"/measurements")}}]),t}(function(){function e(){Object(p.a)(this,e),this.apiBaseUrl=C.apiBaseUrl}return Object(h.a)(e,[{key:"_query",value:function(e,t){return this._fetch(e,{method:"GET",params:t})}},{key:"_constructQueryParamsString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(t){return"object"===typeof e[t]?e[t].map(function(e){return"".concat(encodeURIComponent(t),"[]=").concat(encodeURIComponent(e))}).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}},{key:"_fetch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.params&&(e="".concat(e,"?").concat(this._constructQueryParamsString(t.params))),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()})}}]),e}()),g=function(e){for(var t=e.linesCount,a=void 0===t?1:t,n=[],i=0;i<a;i++)n.push(r.a.createElement("div",{key:i,className:"line"}));return r.a.createElement("div",{className:"ui placeholder"},n)},b=(a(21),function(e){var t=e.parameter,a=e.unit,n=e.value;if(!t)return r.a.createElement(g,{linesCount:1});var i=n?r.a.createElement("span",null,n," ",a):r.a.createElement("span",null,"-");return r.a.createElement("div",null,r.a.createElement("span",null,t),": ",i)}),k=function(e){var t=e.measurements;if(!t)return r.a.createElement(g,{linesCount:7});var a=[];return t.forEach(function(e){return a.push(r.a.createElement(b,{key:e.parameter,parameter:e.parameter,unit:e.unit,value:e.value}))}),r.a.createElement("div",{className:"event"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"summary"},a)))},j=function(e){function t(){return Object(p.a)(this,t),Object(d.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"getMeasurementsForACity",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._allowedParameters,r=[];return n.forEach(function(n){r.push(a.getMeasurements({city:e,country:t,parameter:n}))}),Promise.all(r).then(function(e){var t=[],a=new Set;return e.forEach(function(e){if(0!==e.results.length){var n=e.results[0];a.add(n.parameter),t.push({parameter:n.parameter,value:n.value,unit:n.unit})}}),n.forEach(function(e){a.has(e)||t.push({parameter:e,value:null,unit:null})}),t})}}]),t}(E),w=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(y.a)(t).call(this))).measurementsService=new j,a.state={city:e.city,country:e.country,parametersToDisplay:e.parametersToDisplay,measurements:null},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this._getMeasurementsForTheCity()}},{key:"componentDidUpdate",value:function(e){e.parametersToDisplay!==this.props.parametersToDisplay&&this.setState({parametersToDisplay:this.props.parametersToDisplay,measurements:null},this._getMeasurementsForTheCity)}},{key:"_getMeasurementsForTheCity",value:function(){var e=this;this.measurementsService.getMeasurementsForACity(this.state.city,this.state.country,this.state.parametersToDisplay).then(function(t){e.setState({measurements:t})})}},{key:"render",value:function(){return this.state.city?r.a.createElement("div",{className:"ui card"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},this.state.city)),r.a.createElement("div",{className:"content"},r.a.createElement("h4",{className:"ui sub header"},"Measurements"),r.a.createElement(k,{measurements:this.state.measurements}))):r.a.createElement(g,{linesCount:3})}}]),t}(n.Component),O=function(e){var t=e.cities,a=e.parametersToDisplay,n=e.count,i=void 0===n?20:n;if(!t)return r.a.createElement("div",{class:"ui loader"});var s=t.slice(0,i).map(function(e){return r.a.createElement(w,{key:e.city+e.country,city:e.city,country:e.country,parametersToDisplay:a})});return r.a.createElement("div",{className:"ui cards"},s)},S=function(e){var t=e.onInput,a=e.onSelect,n=e.values,i=e.placeholder;if(!n)return"";var s=n.map(function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.text)});return r.a.createElement("div",null,r.a.createElement("div",{className:"ui input"},r.a.createElement("input",{type:"text",placeholder:"Search for a ".concat(i," ..."),onInput:function(e){return t(e.target.value)}})),r.a.createElement("select",{placeholder:"Select ".concat(i),onChange:function(e){return a(e.target.value)}},r.a.createElement("option",{value:""},"Select ",i),s))},_=function(e){function t(){var e;return Object(p.a)(this,t),(e=Object(d.a)(this,Object(y.a)(t).call(this))).openAQService=new E,e.state={cities:[],autoCompleteCities:[],filteredParameters:C.allowedParameters,citiesCount:20,selectedCity:null},e.onCityAutocompleteInput=e.onCityAutocompleteInput.bind(Object(v.a)(e)),e.onCitySelect=e.onCitySelect.bind(Object(v.a)(e)),e.loadMoreCities=e.loadMoreCities.bind(Object(v.a)(e)),e}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=Object(m.a)(u.a.mark(function e(){var t,a,n=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.openAQService.getCities();case 2:if(!((t=e.sent).meta&&t.meta.found>100)){e.next=7;break}return e.next=6,this.openAQService.getCities({limit:t.meta.found});case 6:t=e.sent;case 7:a=0,t=t.results.map(function(e){return Object(l.a)({},e,{id:++a,text:e.city})}),this.setState({cities:t,autoCompleteCities:t}),navigator.geolocation.getCurrentPosition(function(){var e=Object(m.a)(u.a.mark(function e(t){var a,r,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.openAQService.getNearestCityByCoordinates(t.coords.latitude,t.coords.longitude);case 2:(a=e.sent).results.length&&(r=a.results[0],i=n.state.cities.find(function(e){return e.city===r.city&&e.country===r.country}),n.setState({selectedCity:i}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadMoreCities",value:function(){this.setState({citiesCount:this.state.citiesCount+20})}},{key:"getSuggestedCities",value:function(e){e?this.setState({autoCompleteCities:this.state.cities.filter(function(t){return-1!==t.city.toLowerCase().indexOf(e.toLowerCase())})}):this.setState({autoCompleteCities:this.state.cities})}},{key:"onCityAutocompleteInput",value:function(e){this.getSuggestedCities(e)}},{key:"onCitySelect",value:function(e){this.setState({selectedCity:this.state.cities.find(function(t){return t.id===parseInt(e)})})}},{key:"onParametersChange",value:function(e){var t=Object(c.a)(e.target.children).filter(function(e){return e.selected}).map(function(e){return e.value});t.includes("all")?this.setState({filteredParameters:C.allowedParameters}):this.setState({filteredParameters:t})}},{key:"render",value:function(){var e=this,t=this.state.selectedCity?r.a.createElement("div",null,r.a.createElement("div",null,"Selected city information"),r.a.createElement(w,{key:this.state.selectedCity.id,city:this.state.selectedCity.city,country:this.state.selectedCity.country,parametersToDisplay:this.state.filteredParameters}),r.a.createElement("hr",null)):"",a=C.allowedParameters.map(function(e){return r.a.createElement("option",{key:e,value:e},e)});return r.a.createElement("div",{className:"App",style:{marginLeft:"5%",marginRight:"5%",paddingTop:"3%"}},r.a.createElement(S,{values:this.state.autoCompleteCities,onInput:this.onCityAutocompleteInput,onSelect:this.onCitySelect,placeholder:"city"}),r.a.createElement("hr",null),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:""},"Filter parameters."),r.a.createElement("select",{onChange:function(t){return e.onParametersChange(t)},style:{width:"200px",height:"150px"},name:"",multiple:!0,id:""},r.a.createElement("option",{key:"all",value:"all"},"All"),a),r.a.createElement("hr",null)),t,r.a.createElement(O,{cities:this.state.cities,parametersToDisplay:this.state.filteredParameters,count:this.state.citiesCount}),r.a.createElement("hr",null),r.a.createElement("button",{className:"massive ui button",onClick:this.loadMoreCities},"Load more"))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[13,1,2]]]);
//# sourceMappingURL=main.bd0f1003.chunk.js.map